using System.Collections;
using System.Collections.Generic;
using UnityEditor.Experimental;
using UnityEngine;
using UnityEngine.UI;

public class SlotExploit : Slot
{
    public Exploitation exploitation;

    [SerializeField] private GameObject boutonBonusOutil;
    [SerializeField] private Sprite spriteBonusOutilActive;
    private Sprite spriteBonusOutilDefaut;


    // Start is called before the first frame update
    void Start()
    {
        InterfaceRessource.Actuel.EventInterfaceMAJ.AddListener(MAJBoutonBonusOutil);
        demo = exploitation.expedition.tribu.demographie;

        boutonBonusOutil.SetActive(false);

        spriteBonusOutilDefaut = boutonBonusOutil.GetComponent<Image>().sprite;
    }

    public override void CliquerSurSlot()
    {
        base.CliquerSurSlot();
        exploitation.AfficherGainRessource();
    }

    protected override void retirerPop()
    {
        base.retirerPop();

        boutonBonusOutil.SetActive(false);

        if (bonusOutil)
        {
            bonusOutil = false;
            boutonBonusOutil.GetComponent<Image>().sprite = spriteBonusOutilDefaut;
        }
    }

    protected override void AssignerPop()
    {
        base.AssignerPop();
        boutonBonusOutil.SetActive(true);
    }

    private bool yASuffisammentOutil
    {
        get
        {
            if (ListeRessources.Defaut && (exploitation.expedition.tribu.stockRessources.RessourcesEnStock.gains[ListeRessources.Defaut.TrouverIndexRessource("Outil")] > 0
                || exploitation.expedition.tribu.stockRessources.ProjectionGain.gains[ListeRessources.Defaut.TrouverIndexRessource("Outil")] > 0))
            {
                return true;
            }
        
            else return false;
        }
    }

    [HideInInspector]public bool bonusOutil;
    public void CliquerSurBoutonOutil()
    {
        bonusOutil = !bonusOutil;
        if(bonusOutil && yASuffisammentOutil)
        {
            boutonBonusOutil.GetComponent<Image>().sprite = spriteBonusOutilActive;
        }
        else if(!bonusOutil)
        {
            boutonBonusOutil.GetComponent<Image>().sprite = spriteBonusOutilDefaut;
        }
        exploitation.AfficherGainRessource();
    }

    private void MAJBoutonBonusOutil()
    {
        StockRessource stock = exploitation.expedition.tribu.stockRessources;

        if (yASuffisammentOutil || bonusOutil)
        {
            boutonBonusOutil.GetComponent<Button>().interactable = true;
        }
        else
        {
            boutonBonusOutil.GetComponent<Button>().interactable = false;
        }

        if(ListeRessources.Defaut && bonusOutil && (stock.ProjectionGain.gains[ListeRessources.Defaut.TrouverIndexRessource("Outil")] < 0
            || stock.RessourcesEnStock.gains[ListeRessources.Defaut.TrouverIndexRessource("Outil")] < 0))
        {
            CliquerSurBoutonOutil();
            boutonBonusOutil.GetComponent<Button>().interactable = false;
        }
    }
}
